-*-outline-*-

* DO THIS FIRST. I MEAN IT.
$ sudo -H -s -u postgres
$ unset PGHOST PGPORT
$ export PGUSER=postgres
$ export PGDATA=/srv/postgresql

* preparing and starting a database "cluster" (instance of postgresql) for the first time
$ initdb --locale=C -D $PGDATA
$ pg_ctl -D $PGDATA -l $PGDATA/postgresql.log start

* configure the cluster
$ psql -d template1 -c "alter user $PGUSER password 'thepass'";
$ cp csb-db/conf/{postgresql.conf,pg_hba.conf} $PGDATA/
$ pg_ctl -l $PGDATA/log -D $PGDATA restart

* languages and unison C functions
$ cd csb-db/unison/src
$ make unison.so
$ make install

* creating users
$ createuser -i2 -A -D    PUBLIC
$ createuser -i3 -A -D -P unison
$ createuser -i4 -A -D -P loader
$ csb-db/sbin/passwd2sql </etc/passwd -g1279,227,199,136,140,201,202,984,81 \
  | psql -Upostgres -hcsb -dtemplate1 -qaf-


* stopping/starting/restarting the database
$ pg_ctl -l $PGDATA/postgresql.log stop
$ pg_ctl -l $PGDATA/postgresql.log start
$ pg_ctl -l $PGDATA/postgresql.log restart

* backups and restore
backups are kept in ~rkh/csb-db/backups/csb/.

Prior to 2005-02-02, full backups are named <timestamp>.pgdump.gz;
schema-only backups are named <timestamp>-s.pgdump.gz. 'pgdump-s' files
are schema-only. Either type may be resotred with psql, like this:
$ gzip -cdq backup.pgdump.gz | psql -dcsb-dev -af- >restore.log 2>&1

Beginning 2005-02-02, I started using pg_dump "custom" format. These are
stored in the same directory. Individual records in the dump are
compressed, but the archive itself is not. See pg_restore for information
on restoring, but it goes something like this:
$ createdb csbA
$ pg_restore -v -dcsbA 2005-02-02-06\:20.pgdump >|csbA.restore 2>&1 &
I /highly/ recommend creating into an empty database with an unlikely db
name to preclude inadvertenly overwritting an existing db.

* setting the default database schema search path:
$ export PGDATABASE=csb-dev
$ psql -c "alter database $PGDATABASE set search_path = '\$user',unison,gong,scop,tax,public";
Note: You should connect to the same database that you're modifying, as above.

